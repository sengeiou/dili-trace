<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.dili.trace.dao.CheckinOutRecordMapper">
  

        
    <select id="queryBillReport" parameterType="com.dili.trace.dto.BillReportQueryDto" resultType="com.dili.trace.dto.BillReportDto">

        select 
        register_bill.id as bill_id
        ,register_bill.code as bill_code
        ,register_bill.name as user_name
        ,register_bill.plate 
        ,register_bill.brand_name
        ,register_bill.preserve_type 
        ,register_bill.origin_name 
        ,register_bill.verify_status  
        ,register_bill.product_name
        ,register_bill.weight
        ,register_bill.weight_unit 
        ,register_bill.created AS 'bill_created'
        ,u.phone
        ,u.tally_area_nos
        ,u.legal_person
        ,checkinout_record.created AS 'checkin_created'
        ,checkinout_record.status AS checkin_status
        from register_bill left join trade_detail on register_bill.id=trade_detail.bill_id
        left join checkinout_record on checkinout_record.id=trade_detail.checkin_record_id
        left join `user` u on register_bill.user_id=u.id
        where trade_detail.parent_id is null

    <if test="billCreatedStart != null  and billCreatedStart != ''">
        <![CDATA[ AND #{billCreatedStart}<=register_bill.created ]]>
    </if>
    <if test="billCreatedEnd != null  and billCreatedEnd != ''">
        <![CDATA[AND register_bill.created <=#{billCreatedEnd}]]>
    </if>
    <if test="verifyStatus != null">
        AND register_bill.verify_status =#{verifyStatus}
    </if>
    <if test="likeProductName != null  and likeProductName != ''">
        AND register_bill.product_name like '%${likeProductName}%'
    </if>
    <if test="productId != null">
        AND register_bill.product_id =#{productId}
    </if>
    <if test="originId != null">
        AND register_bill.origin_id =#{originId}
    </if>
    <if test="likePlate != null and likePlate != ''">
        AND register_bill.plate like '%${likePlate}%'
    </if>
    
    <if test="includeUnCheckin != null">
        <if test="includeUnCheckin == true">
            <![CDATA[AND (checkinout_record.`status` is null or checkinout_record.`status`<>10)]]>
        </if>
        <if test="includeUnCheckin == false">
            AND checkinout_record.`status`=10
        </if>
    </if>
    </select>
</mapper>