<#echartJs></#echartJs>
 <#body>
    <div class="easyui-layout" fit="true">
        <!-- ====================================================================================================================== -->
        <!-- 上方布局 -->
        <!-- ====================================================================================================================== -->
        <div region="north" height="auto" align="center">
            <!--<div id="nav" class="top-pos-box">
                <span><img class="nav-pos-icon" src="${contextPath}/resources/images/pos-icon.png">当前位置:</span>
                <span>登记单管理&nbsp&gt;</span>
                <span><a class="link-text" href="">登记单列表</a></span>
            </div>-->
            <!-- =========================================================表单========================================================= -->
            <div class="easyui-panel" style="width:100%;" align="left">
                            </div>
        </div>
        <!-- ====================================================================================================================== -->
        <!-- 中央布局 -->
        <!-- ====================================================================================================================== -->
        <!-- 表格 -->
        <div region="center" style="width:100%;" height="auto">
            <!-- =========================================================表格========================================================= -->
            <div id="tt" class="easyui-tabs" style="width:100%;height:100%;" data-options="onSelect:onSelectTab">
    <div title="运输重量图表" style="padding:20px;" id="totalWeight"  data-id="id:'sss'">
		<div id="totalWeightPie" style="width:98%; height:50%;" data-legend="productName" data-series="totalWeight"></div>
		<div id="totalWeightBar" style="width:98%; height:50%;"  data-axis="productName" data-series="totalWeight"></div>
    </div>
    <div title="商品进场图表" data-options="closable:false" style="overflow:auto;padding:20px;" id="cnt">
		<div id="cntPie" style="width:98%; height:50%;" data-legend="productName" data-series="cnt"></div>
		<div id="cntBar" style="width:98%; height:50%;" data-axis="productName" data-series="cnt"></div>
    </div>
    <div title="商品采样图表" data-options="closable:false" style="padding:20px;" id="totalCheckingOrRechecking">
		<div id="totalCheckingOrRecheckingPie" style="width:98%; height:50%;" data-legend="productName" data-series="totalCheckingOrRechecking"></div>
		<div id="totalCheckingOrRecheckingBar" style="width:98%; height:50%;"  data-axis="productName" data-series="totalCheckingOrRechecking"></div>
    </div>
    <div title="检测数量图表" data-options="closable:false" style="padding:20px;" id="totalCheckedOrRechecked">
		<div id="totalCheckedOrRecheckedPie" style="width:98%; height:50%;" data-legend="productName" data-series="totalCheckedOrRechecked"></div>
		<div id="totalCheckedOrRecheckedBar" style="width:98%; height:50%;"  data-axis="productName" data-series="totalCheckedOrRechecked"></div>
    </div>
    <div title="复检数量图表" data-options="closable:false" style="padding:20px;" id="totalRechecked">
		<div id="totalRecheckedPie" style="width:98%; height:50%;" data-legend="productName" data-series="totalRechecked"></div>
		<div id="totalRecheckedBar" style="width:98%; height:50%;"   data-axis="productName" data-series="totalRechecked"></div>
    </div>
    <div title="初检合格图表" data-options="closable:false" style="padding:20px;" id="totalSuccessfulInitalChecked">
		<div id="totalSuccessfulInitalCheckedPie" style="width:98%; height:50%;" data-legend="productName" data-series="totalSuccessfulInitalChecked"></div>
		<div id="totalSuccessfulInitalCheckedBar" style="width:98%; height:50%;"   data-axis="productName" data-series="totalSuccessfulInitalChecked"></div>
    </div>
    <div title="复检合格图表" data-options="closable:false" style="padding:20px;" id="totalSuccessfulRechecked">
				<div id="totalSuccessfulRecheckedPie" style="width:98%; height:50%;" data-legend="productName" data-series="totalSuccessfulRechecked"></div>
		<div id="totalSuccessfulRecheckedBar" style="width:98%; height:50%;"   data-axis="productName" data-series="totalSuccessfulRechecked"></div>
    </div>
    <div title="产地证明图表" data-options="closable:false" style="padding:20px;" id="totalHascertifiy">
						<div id="totalHascertifiyPie" style="width:98%; height:50%;" data-legend="productName" data-series="totalHascertifiy"></div>
		<div id="totalHascertifiyBar" style="width:98%; height:50%;"   data-axis="productName" data-series="totalHascertifiy"></div>
    </div>
    <div title="检测报告图表" data-options="closable:false" style="padding:20px;" id="totalHasdetectreport">
							<div id="totalHasdetectreportPie" style="width:98%; height:50%;" data-legend="productName" data-series="totalHasdetectreport"></div>
		<div id="totalHasdetectreportBar" style="width:98%; height:50%;"   data-axis="productName" data-series="totalHasdetectreport"></div>
    </div>
</div>
        </div>
    </div>
      <!-- 隐藏编辑框 -->
    <!-- ====================================================================================================================== -->
    <!-- style & script 分隔线 -->
    <!-- ====================================================================================================================== -->

     <script src="http://base.nong12.com/static/log/log.build.js"></script>
     <link rel="stylesheet" type="text/css" href="${contextPath!}/resources/jquery-file-upload/css/jquery.fileupload.css">
     <script src="${contextPath!}/resources/jquery-file-upload/js/vendor/jquery.ui.widget.js"></script>
     <script src="${contextPath!}/resources/jquery-file-upload/js/jquery.iframe-transport.js"></script>
     <script src="${contextPath!}/resources/jquery-file-upload/js/jquery.fileupload.js"></script>
     <script src="/resources/assets/dep/jquery/layer/layer.js"></script>
     <script type="text/javascript">
     var params=${params};
     

     (function(){//扩展easyui中tabs的部分方法，实现根据唯一标识id的进行相应操作；技巧：使用一个自执行的函数，激发作用域，避免这里定义的变量与系统全局变量冲突
     	var _methods = $.fn.tabs.methods;
     	var _exists = _methods.exists;//保存原方法
     	var _getTab = _methods.getTab;//<span style="font-family: Arial, Helvetica, sans-serif;">//保存原方法</span>
     	$.extend($.fn.tabs.methods, {
     		getTab : function(jq, which) {//重写getTab方法，增加根据id获取tab（注意：这里我们可以定义任意的获取方式，不必一定使用id）
     			if(!which) return null;
     			var tabs = jq.data('tabs').tabs;
     			for (var i = 0; i < tabs.length; i++) {
     				var tab = tabs[i];
     				if (tab.panel("options").id==which) {
     					return tab;
     				}
     			}
     			return _getTab(jq, which);//如果根据id无法获取，则通过easyui默认的getTab进行获取
     		},
     		exists : function(jq, which) {//重写exists方法，增加id判断
     			return this.getTab(jq,which)!=null;//调用重写后的getTab方法
     		},
     	});
     })()

     $(function(){
    	 if(params.chartId&&params.chartId!='') {
    		 var index =	 $('.tabs-panels .panel-htop').children('div').index ($ ( '#'+params.chartId ));
    		 delete params.chartId
			$('#tt').tabs('select', index);
         }
     });

    
     
      
     function onSelectTab(title,index){
    	 if(params.chartId&&params.chartId!='') {
    		 return;
    	 }
    	 var tab = $('#tt').tabs('getSelected');
    	 var id=tab.attr('id');
    	 var pieChartId=id+"Pie";
    	 var pieChartId=id+"Bar";
         $("#"+pieChartId).css('width',$("#tt").width());
         $("#"+pieChartId).css('height',$("#tt").height()/2);
         $("#"+pieChartId).css('width',$("#tt").width());
         $("#"+pieChartId).css('height',$("#tt").height()/2);
    
    	  PieChart(id,title);
    	  BarChart(id,title);
     }
     function queryData(url,params){
    	 var result=[];
         $.ajax({
             type: "POST",
             url: url,
             data: JSON.stringify(params),
             processData:true,
             dataType: "json",
             async : false,
             contentType: "application/json; charset=utf-8",
             success: function (data) {
                 if(data.code=="200"){
                 	result=data.data;
                 }
             },
             error: function(){
             }
         });
    	return result;
   }
  function buildPieChartData(opts,url,data){
	  var result=queryData(url,data);
      var legendData = [];
      var seriesData = [];
      var selected = {};
	  $.each(result,function(i,v){
		  var legend=v[opts.data('legend')];
		  var series=v[opts.data('series')];
	
		  legendData.push(legend);
		  seriesData.push({name:legend,value:series});
		  selected[legend]=true;
	  });
	  return {
	      legendData:legendData,
	      seriesData:seriesData,
	      selected:selected  
	  }
  }
  
  function buildBarChartData(opts,url,data){
	  var result=queryData(url,data);
 	 var axisData = [];
	 var seriesData = [];
	  $.each(result,function(i,v){
		  var legend=v[opts.data('axis')];
		  var series=v[opts.data('series')];
		  axisData.push(legend);
		  seriesData.push(series);
	  }); 
	 // debugger;
	  return {
		  axisData:axisData,
		  seriesData:seriesData,
	  }
  }
     
    
     function PieChart(id,title){
    	 var divid=id+'Pie';
    	 var pieChartDiv=$('#'+divid);
//    	 console.info(pieChartDiv)
   // 	 debugger
    	 var data=buildPieChartData(pieChartDiv,'/registerBillReport/getProductChartsJson.action',$.extend(params,{'sort':id,'order':'desc','sumOthers':true}));
    	 //debugger
    	 //var data = genData(21);
         var chartObj = echarts.init(document.getElementById(divid));
         option = {
             title: {
                 text:title,
                // subtext: '纯属虚构',
                 left: 'center'
             },
             tooltip: {
                 trigger: 'item',
                // formatter: '{a} <br/>{b} : {c} ({d}%)'
                 formatter: '{b} : {c} ({d}%)'
             },
             legend: {
                 type: 'scroll',
                 orient: 'vertical',
                 right: 10,
                 top: 20,
                 bottom: 20,
                 data: data.legendData,
                 selected: data.selected
             },
             series: [
                 {
                    // name: '姓名',
                     type: 'pie',
                     radius: '55%',
                     center: ['40%', '50%'],
                     data: data.seriesData,
                     emphasis: {
                         itemStyle: {
                             shadowBlur: 10,
                             shadowOffsetX: 0,
                             shadowColor: 'rgba(0, 0, 0, 0.5)'
                         }
                     }
                 }
             ]
         };
         chartObj.setOption(option);
     }
          
     function BarChart(id,title){
    	 var divid=id+'Bar';
    	 var barChartDiv=$('#'+divid);
    	 
    	 var chartObj = echarts.init(document.getElementById(divid));
    	 var data=buildBarChartData(barChartDiv,'/registerBillReport/getProductChartsJson.action',$.extend(params,{'sort':id,'order':'desc','sumOthers':false}));
    	 //debugger;
    	 var dataAxis =data.axisData;// ['点', '击', '柱', '子', '或', '者', '两', '指', '在', '触', '屏', '上', '滑', '动', '能', '够', '自', '动', '缩', '放'];
    	 var data =data.seriesData;// [220, 182, 191, 234, 290, 330, 310, 123, 442, 321, 90, 149, 210, 122, 133, 334, 198, 123, 125, 220];
    	 var yMax = 0;
    	 var dataShadow = [];

    	 for (var i = 0; i < data.length; i++) {
    	     dataShadow.push(yMax);
    	 }

    	 var option = {
    	     title: {
    	     //    text: '特性示例：渐变色 阴影 点击缩放',
    	      //   subtext: 'Feature Sample: Gradient Color, Shadow, Click Zoom'
    	     },
    	     xAxis: {
    	         data: dataAxis,
    	         axisLabel: {
    	             inside: true,
    	             textStyle: {
    	                 color: '#000'
    	             },
  	        		interval: 0,
 	        		formatter: function (value) {
 	        			//x轴的文字改为竖版显示
 	        			var str = value.split("");
 	        			return str.join("\n");
 	        		}
    	         },
    	         axisTick: {
    	             show: true
    	         },
    	         axisLine: {
    	             show: true
    	         },
    	         z: 100
    	     },
    	     yAxis: {
    	         axisLine: {
    	             show: true
    	         },
    	         axisTick: {
    	             show: true
    	         },
    	         axisLabel: {
    	             textStyle: {
    	                 color: '#999'
    	             }
    	         }
    	     },
    	     dataZoom: [
    	         {
    	             type: 'inside'
    	         }
    	     ],
    	     series: [
    	         { // For shadow
    	             type: 'bar',
    	             itemStyle: {
    	                 color: 'rgba(0,0,0,0.05)'
    	             },
    	             barGap: '-100%',
    	             barCategoryGap: '40%',
    	             data: dataShadow,
    	             animation: false
    	         },
    	         {
    	             type: 'bar',
    	             itemStyle: {
    	                 color: new echarts.graphic.LinearGradient(
    	                     0, 0, 0, 1,
    	                     [
    	                         {offset: 0, color: '#83bff6'},
    	                         {offset: 0.5, color: '#188df0'},
    	                         {offset: 1, color: '#188df0'}
    	                     ]
    	                 )
    	             },
    	             emphasis: {
    	                 itemStyle: {
    	                     color: new echarts.graphic.LinearGradient(
    	                         0, 0, 0, 1,
    	                         [
    	                             {offset: 0, color: '#2378f7'},
    	                             {offset: 0.7, color: '#2378f7'},
    	                             {offset: 1, color: '#83bff6'}
    	                         ]
    	                     )
    	                 }
    	             },
    	             data: data
    	         }
    	     ]
    	 };
    	 chartObj.setOption(option);
    	 // Enable data zoom when user click bar.
    	 var zoomSize = 6;
    	 chartObj.on('click', function (params) {
    	     //console.log(dataAxis[Math.max(params.dataIndex - zoomSize / 2, 0)]);
    	     chartObj.dispatchAction({
    	         type: 'dataZoom',
    	         startValue: dataAxis[Math.max(params.dataIndex - zoomSize / 2, 0)],
    	         endValue: dataAxis[Math.min(params.dataIndex + zoomSize / 2, data.length - 1)]
    	     });
    	 });
     }
     </script>
     

 </#body>