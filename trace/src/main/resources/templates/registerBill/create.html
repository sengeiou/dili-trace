


<#bodyOrigin>


<div class="main-container">
    <div class="topicTop">
        <div class="toppic-title">
            <span class="topic-title-text maincolor">进场货品登记</span>
            <button class="btn-greyweak btn-sm topic-back-btn">返回</button>
        </div>
    </div>

    <div class="form-box border">

        <form class="form-inline" role="form">
            <div class="form-item-group">
                <h4 class="form-item-title">基础信息</h4>
                <div class="form-group">
                    <label class="label-title text-right"><span class="red">&lowast;</span>登记来源</label>
                    <select class="form-control input-sm" name="createOrigin" required>
                        <option value="1">理货区</option>
                        <option value="2">交易区</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="label-title text-right">
                        <span class="red">&lowast;</span>理货区号</label>
                    <input type="text" class="form-control input-sm" name="a1" required />
                </div>
                <div class="form-group">
                    <label class="label-title text-right">
                        <span class="red">&lowast;</span>车牌号</label>
                    <input type="text" class="form-control input-sm" name="a2" required />
                </div>
                <div class="form-group" style="display: none;">
                    <label class="label-title text-right">交易卡号</label>
                    <input type="text" class="form-control input-sm" name="b1" />
                </div>
                <div class="form-group" style="display: none;">
                    <label class="label-title text-right">印刷卡号</label>
                    <input type="text" class="form-control input-sm" name="b2" />
                </div>
                <br>
                <div class="form-group">
                    <label class="label-title text-right">
                        <span class="red">&lowast;</span>业户姓名</label>
                    <input type="text" class="form-control input-sm" required />
                </div>
                <div class="form-group">
                    <label class="label-title text-right">
                        <span class="red">&lowast;</span>身份证号</label>
                    <input type="text" class="form-control input-sm isIdCard0" required />
                </div>
                <div class="form-group">
                    <label class="label-title text-right"><span class="red">&lowast;</span>身份证地址</label>
                    <textarea class="form-control" cols="70" rows="1" maxlength="50" required></textarea>
                </div>
            </div>

            <div class="form-item-group">
                <h4 class="form-item-title">货品信息</h4>
                <button type="button" class="btn-main2 btn-sm" id="addGoodsItem">添加货品</button>
                <div class="table-showlist" style="width: 1200px">
                    <table class="table table-bordered" id="goodsTable">
                        <tr>
                            <th><span class="red">&lowast;</span>商品名称</th>
                            <th><span class="red">&lowast;</span>产地</th>
                            <th><span class="red">&lowast;</span>商品重量</th>
                            <th>产地证明</th>
                            <th>操作</th>
                        </tr>
                        <tr>
                            <td>
                                <div class="form-group">
                                    <input type="text" id="goodsName" class="form-control input-sm" required />
                                    <input type="text" name="goodsID" hidden />
                                </div>
                            </td>
                            <td>
                                <div class="form-group">
                                    <input type="text" id="originPlace" class="form-control input-sm" required />
                                    <input type="text" name="originPlaceID" hidden />
                                </div>
                            </td>
                            <td>
                                <div class="form-group">
                                    <input type="text" class="form-control input-sm" required />
                                </div>
                            </td>
                            <td>
                                <div class="imageUploadWrap">
                                    <div class="form-group">
                                        <div class="imageUpload rectangle">
                                            <a href="javascript:;" class="edit-zoom">放大</a>
                                            <input type="file" name="image" class="form-control input-sm choose-image" accept="image/*">
                                            <img src="" alt="" class="show-image">
                                        </div>
                                    </div>
                                </div>
                            </td>
                            <td><a href="javascript:;" class="split-minus-btn">删除</a></td>
                        </tr>
                    </table>
                    <!-- 表格后的统计 end -->
                </div>
            </div>
            <div class="form-item-group">
                <h4 class="form-item-title">检疫检测报告</h4>
                <div class="imageUploadWrap">
                    <div class="form-group">
                        <div class="imageUpload rectangle">
                            <a href="javascript:;" class="edit-zoom">放大</a>
                            <input type="file" name="image" class="form-control input-sm choose-image" accept="image/*">
                            <img src="" alt="" class="show-image">
                        </div>
                    </div>
                </div>
            </div>
        </form>

    </div>
    <h5 class="mt10 red">操作员：陈良芳</h5>
    <div class="text-center mt30">
        <button class="btn-main2 btn-sm">提交</button>&nbsp;&nbsp;
        <button class="btn-greyweak btn-sm">取消</button>
    </div>

</div>


</#bodyOrigin>


<script id="goodsItem" type="text/html">
    <tr>
        <td>
            <div class="form-group">
                <input type="text" class="form-control input-sm" name="goodsName{{index}}" required />
            </div>
        </td>
        <td>
            <div class="form-group">
                <input type="text" id="originPlace" class="form-control input-sm" required />
                <input type="text" name="originPlaceID{{index}}" hidden />
            </div>
        </td>
        <td>
            <div class="form-group">
                <input type="text" class="form-control input-sm" name="weight{{index}}" required />
            </div>
        </td>
        <td>
            <div class="imageUploadWrap">
                <div class="form-group">
                    <div class="imageUpload rectangle">
                        <a href="javascript:;" class="edit-zoom">放大</a>
                        <input type="file" name="image{{index}}" class="form-control input-sm choose-image" accept="image/*">
                        <img src="" alt="" class="show-image">
                    </div>
                </div>
            </div>
        </td>
        <td><a href="javascript:;" class="split-minus-btn">删除</a></td>
    </tr>
</script>


<script>

    // 验证--
    $('form').validate()

    /*
     ajax自动完成
     API: https://github.com/devbridge/jQuery-Autocomplete/
     */
    $('#originPlace').autocomplete({
        serviceUrl: '',
        dataType: 'json',
        maxHeight: 300,
        showNoSuggestionNotice: true,
        noSuggestionNotice: '不存在',
        onSearchComplete: function (query, suggestions) {
            // 查询出多条数据时 || 查询出单条数据且查询内容和查询结果不等时 => 清空清空货物ID
            if (suggestions.length !== 1 || (suggestions.length === 1 && $(this).val() !== suggestions[0].name)) {
                $('[name="originPlaceID"]').val('')
            }
            // 其他逻辑
            // 。。。。
        },
        onSelect: function (suggestion) {
            $('[name="originPlaceID"]').val(suggestion.id)
            // 其他逻辑
            // 。。。。
        },
        onHide: function (container) {
            // 输入数据后未全匹配，且未选择就清空当前数据。
            if ($('[name="originPlaceID"]').val() === '') {
                $(this).val('')
            }
        }
    });


    /*   登记来源     */
    $('[name="createOrigin"]').on('change', function () {
        if ($(this).val() === '1') {
            $('[name="a1"], [name="a2"]').closest('.form-group').show();
            $('[name="b1"], [name="b2"]').closest('.form-group').hide();
        } else {
            $('[name="a1"], [name="a2"]').closest('.form-group').hide();
            $('[name="b1"], [name="b2"]').closest('.form-group').show();
        }
    })

    /* 货品表格  */
    let goodsItemCount = 0;
    $('.main-container').on('click', '#addGoodsItem', function () {
        $('#goodsTable tbody').append(template('goodsItem', {index: goodsItemCount++}))

    })
    $('.main-container').on('click', '.split-minus-btn', function () {
        if ($('#goodsTable tr').length > 2) {
            $(this).closest('tr').remove();
        }
    })


    /*  选择图片  */
    $('.main-container').on('change', '.choose-image', function () {
        $('.choose-image').val()
        let filePath = $(this).val()
        if (!filePath || ! /\.(jpg|jpeg|gif|bmp|png)$/i.test(filePath)) {
            $(this).val('')
            $(this).siblings('.show-image').attr('src', '')
            return false;
        } else {
            let src = window.URL.createObjectURL(this.files[0])
            $(this).siblings('.show-image').attr('src', src)
        }
    })
    $('.main-container').on('click', '.imageUploadWrap .edit-zoom', function () {
        layer.open({
            type: 1,
            skin: 'layui-layer-rim',
            closeBtn: 2,
            area: ['90%', '90%'], //宽高
            content: '<p style="text-align:center"><img src="' + $(this).siblings('.show-image').attr('src') + '" alt="" class="show-image-zoom"></p>'
        });
    })




</script>
